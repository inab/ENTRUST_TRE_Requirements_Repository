<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Requirement</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <div id="content"></div>

<script src="js/load.js"></script>
<script>
  function renderValue(value, key = "") {
  if (key === "Evidence" && Array.isArray(value)) {
    return `
      <ul>
        ${value.map(ev => `
          <li>
            <strong>${ev["E#"]}</strong> — ${ev["Evidence Artifact Example"]}
            <a href="${ev.File}">JSON</a>
          </li>
        `).join("")}
      </ul>
    `;
  }

  if (Array.isArray(value)) {
    return `<ul>${value.map(v => `<li>${renderValue(v)}</li>`).join("")}</ul>`;
  }

  if (typeof value === "object" && value !== null) {
    return `<ul>${Object.entries(value).map(
      ([k, v]) => `<li><strong>${k}</strong>: ${renderValue(v)}</li>`
    ).join("")}</ul>`;
  }

  return value === "" ? "<em>(empty)</em>" : value;
}

  async function loadRequirement() {
    const params = new URLSearchParams(window.location.search);
    const id = params.get("id");

    if (!id) {
      document.body.innerHTML = "<p>Missing requirement ID</p>";
      return;
    }

    const req = await loadJSON(`../requirements/${id}.json`);

    let html = `<h1>${req["R#"]} — ${req.Title} 
                <a href="../requirements/${id}.json">JSON</a></h1>`;
    
    html += `<ul>`;
    for (const [key, value] of Object.entries(req)) {
      if (key === "R#" || key === "Title") continue;

      html += ` 
        <li>
          <strong>${key}</strong> : ${renderValue(value, key)}
        </li>
      `;
    }
    html += `</ul>`;

    html += `<p><a href="index.html">← Back to index</a></p>`;

    document.body.innerHTML = html;
  }

  loadRequirement();
</script>

</body>
</html>